<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.lib.fin.approval.ApprovalDAO">
  
  	<!-- file add -->
  	<insert id="setFileAdd" parameterType="ApprovalFileVO">
  		INSERT INTO APPROVAL_FILE(APPROVAL_FILE_NO, DOC_NO, APPROVAL_FILENAME,APPROVAL_PATH, REG_ID,MOD_ID,REG_DATE,MOD_DATE,USE_YN)
  		VALUES(#{file_no},#{doc_no},#{file_name},#{file_path},'1','1',now(),now(),'Y')
  	</insert>
  	
  		
  	<!-- 기안 add -->
  	<insert id="setDraft" parameterType="ApprovalDocVO" useGeneratedKeys="true" keyProperty="doc_no">
  	
  		INSERT INTO APPROVAL_DOC VALUES(#{doc_no},#{emp_no},#{grp_cd},#{approval_state},#{doc_title},#{doc_contents},#{start_date},now(),null,null,#{temp_save},#{reg_id},#{mod_id},now(),now(),#{use_yn})
  	</insert>
  	
  	<!-- 결재선 -->
  	<insert id="setApprovalHis" parameterType="ApprovalHisVO">
  		INSERT INTO APPROVAL_HISTORY
  		VALUES(#{approval_no},#{emp_no},#{doc_no},#{approval_level},#{approval_state},#{reg_id},#{mod_id},now(),now(),#{use_yn})
  	</insert>
  	
  	<!-- 문서 리스트 -->
  	<select id="getAppDocList" resultType="ApprovalDocVO" parameterType="String">
  		SELECT ad.REG_DATE,
 		 (SELECT cd_nm 
  		  	FROM ST_STD_CD 
  		 WHERE grp_cd='A001' AND CD= ad.GRP_CD) as grp_cd , ad.DOC_TITLE, ad.DOC_NO,
   		(SELECT cd_nm 
  			FROM ST_STD_CD 
  		 WHERE grp_cd='A002' AND CD= ad.APPROVAL_STATE) as approval_state
			FROM APPROVAL_DOC ad
		WHERE ad.EMP_NO = #{emp_no} and ad.USE_YN ='Y' and ad.TEMP_SAVE = 'N'
		ORDER BY DOC_NO DESC
  	
  	</select>
  
  </mapper>